import{a as I,b as be}from"./chunk-DYBMCYVM.js";import{c as re,d as oe,e as ne,n as ae,o as me,p as le,u as W,v as se}from"./chunk-RZD7PGSG.js";import{a as pe}from"./chunk-YWYD2KRV.js";import{A as P,B as ue,U as ce,a as ie,d as U,e as R,h as A,j as N,k as s,l as T,m as M,n as L,p as j,q,s as k,w as B,x as D,y as O,z as G}from"./chunk-LQYVKD47.js";import{a as y,j as C,m as Q}from"./chunk-C353KNEH.js";import{Bb as p,Gb as v,Lb as u,Mb as i,Nb as n,Ob as d,Vb as g,_c as te,a as h,b as S,e as Ce,f as Z,fc as r,jb as l,ka as ee,kb as c,la as E,pa as w,va as F,wa as x,x as K}from"./chunk-THA4BGIW.js";var he=Ce(be());var b=oe({source:"Auth",events:{"Set Authenticated User":re(),"Unset Autheticate User":ne()}});var de="auth",Se={authenticatedUser:null},Je=se(Se,W(b.setAuthenticatedUser,(e,t)=>S(h({},e),{authenticatedUser:t.user})),W(b.unsetAutheticateUser,e=>S(h({},e),{authenticatedUser:null})));var _e=le(de),fe=me(_e,e=>e.authenticatedUser);var $=class e{constructor(t,a,o){this.router=t;this.httpClient=a;this.store=o;this.authUser$=this.store.select(fe)}authUser$;baseURL=I.apiBaseURL;handleAuthentication(t){return t[0]?(this.store.dispatch(b.setAuthenticatedUser({user:t[0]})),localStorage.setItem("token",t[0].token),t[0]):null}login(t){return this.httpClient.get(`${this.baseURL}/users?email=${t.email}&password=${t.password}`).pipe(K(a=>{let o=this.handleAuthentication(a);if(o)return o;throw new Error("Los datos son invalidos")}))}logout(){this.store.dispatch(b.unsetAutheticateUser()),localStorage.removeItem("token"),this.router.navigate(["auth","login"])}verifyTok(){return this.httpClient.get(`${this.baseURL}/users?token=${localStorage.getItem("token")}`).pipe(K(t=>!!this.handleAuthentication(t)))}static \u0275fac=function(a){return new(a||e)(w(C),w(y),w(ae))};static \u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})};function Ae(e,t){e&1&&r(0," Este campo es requerido ")}function Ne(e,t){e&1&&r(0," Este campo debe ser un correo electronico valido ")}function Te(e,t){e&1&&r(0," Este campo es requerido ")}var V=class e{constructor(t,a,o){this.formBuilder=t;this.authService=a;this.router=o;this.loginForm=this.formBuilder.group({email:["",[s.required,s.email]],password:["",[s.required]]})}passwdInpType="password";loginForm;togglePasswdInpType(){this.passwdInpType==="password"?this.passwdInpType="text":this.passwdInpType="password"}doLogin(){this.authService.login(this.loginForm.value).subscribe({next:t=>{this.router.navigate(["dashboard","home"])},error:t=>{t instanceof Error&&this.showError(t.message)}})}onSubmit(){this.loginForm.invalid?this.loginForm.markAllAsTouched():this.doLogin()}showError(t){return Z(this,null,function*(){return yield he.default.fire({icon:"error",title:"Ups...",text:t})})}goToRegister(){this.router.navigate(["auth","register"])}static \u0275fac=function(a){return new(a||e)(c(k),c($),c(C))};static \u0275cmp=F({type:e,selectors:[["app-login"]],decls:29,vars:4,consts:[["id","loginForm",3,"ngSubmit","formGroup"],[1,"inpCont","row"],["appearance","outline"],["formControlName","email","matInput","","placeholder","Ej: example@mail.com"],["formControlName","password","matInput","","placeholder","Escribe",3,"type"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["id","action-cont",1,"d-flex","align-items-center"],["type","button","mat-button","",3,"click"],[1,"col-12"],["type","submit","mat-flat-button",""]],template:function(a,o){if(a&1&&(i(0,"h2"),r(1,"Inicia Sesion"),n(),i(2,"form",0),g("ngSubmit",function(){return o.onSubmit()}),i(3,"div",1)(4,"mat-form-field",2)(5,"mat-label"),r(6,"Correo electronico"),n(),d(7,"input",3),i(8,"mat-error"),p(9,Ae,1,0)(10,Ne,1,0),n()()(),i(11,"div",1)(12,"mat-form-field",2)(13,"mat-label"),r(14,"Contrase\xF1a"),n(),d(15,"input",4),i(16,"button",5),g("click",function(){return o.togglePasswdInpType()}),i(17,"mat-icon"),r(18," visibility "),n()(),i(19,"mat-error"),p(20,Te,1,0),n()()(),i(21,"div",6)(22,"p"),r(23,"\xBFNo tienes cuenta?"),n(),i(24,"button",7),g("click",function(){return o.goToRegister()}),r(25,"Registrate"),n()(),i(26,"div",8)(27,"button",9),r(28,"Ingresar"),n()()()),a&2){let m,f;l(2),v("formGroup",o.loginForm),l(7),u((m=o.loginForm.get("email"))!=null&&m.hasError("required")?9:(m=o.loginForm.get("email"))!=null&&m.hasError("email")?10:-1),l(6),v("type",o.passwdInpType),l(5),u((f=o.loginForm.get("password"))!=null&&f.hasError("required")?20:-1)}},dependencies:[L,N,T,M,j,q,U,R,A,G,B,D,O,P],styles:[".inpCont[_ngcontent-%COMP%]{width:500px}.inpCont[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#action-cont[_ngcontent-%COMP%]{gap:.25rem}"]})};function Me(e,t){e&1&&r(0," Este campo es requerido ")}function Le(e,t){e&1&&r(0," Este campo debe tener 3 caracteres como m\xEDnimo ")}function je(e,t){e&1&&r(0," Este campo es requerido ")}function qe(e,t){e&1&&r(0," Este campo debe tener 3 caracteres como m\xEDnimo ")}function ke(e,t){e&1&&r(0," Este campo es requerido ")}function Be(e,t){e&1&&r(0," Este campo debe ser un correo electronico valido ")}function De(e,t){e&1&&r(0," Este campo es requerido ")}function Oe(e,t){e&1&&r(0," Este campo es requerido ")}var J=class e{constructor(t,a,o){this.formBuilder=t;this.router=a;this.httpsClient=o;this.registerForm=this.formBuilder.group({firstName:["",[s.required,s.minLength(3)]],lastName:["",[s.required,s.minLength(3)]],email:["",[s.required,s.email]],password:["",[s.required]],role:["",[s.required]]})}baseURL=I.apiBaseURL;passwdInpType="password";registerForm;togglePasswdInpType(){this.passwdInpType==="password"?this.passwdInpType="text":this.passwdInpType="password"}createUser(t){return this.httpsClient.post(`${this.baseURL}/users`,S(h({},t),{token:pe(20)}))}onSubmit(){if(this.registerForm.invalid)this.registerForm.markAllAsTouched();else{let t=h({},this.registerForm.value);this.createUser(t).subscribe({next:()=>{this.router.navigate(["auth","login"])},error:a=>{alert(a)}})}}static \u0275fac=function(a){return new(a||e)(c(k),c(C),c(y))};static \u0275cmp=F({type:e,selectors:[["app-register"]],decls:53,vars:7,consts:[["id","registerForm",3,"ngSubmit","formGroup"],[1,"row","w-100"],[1,"col-6"],["appearance","outline",1,"w-100"],["formControlName","firstName","matInput","","placeholder","Ej: Juan"],["formControlName","lastName","matInput","","placeholder","Ej: Juan"],[1,"row"],["appearance","outline"],["formControlName","email","matInput","","placeholder","Ej: example@mail.com"],["appearance","outline","id","passwd-user"],["formControlName","password","matInput","","placeholder","Ej: Perez",3,"type"],["type","button","matSuffix","","mat-icon-button","",3,"click"],["formControlName","role"],["value","USER"],["value","ADMIN"],[1,"col-12"],["type","submit","mat-flat-button","",1,"w-90"]],template:function(a,o){if(a&1&&(i(0,"h2"),r(1,"Create una cuenta"),n(),i(2,"form",0),g("ngSubmit",function(){return o.onSubmit()}),i(3,"div",1)(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),r(7,"Nombre"),n(),d(8,"input",4),i(9,"mat-error"),p(10,Me,1,0)(11,Le,1,0),n()()(),i(12,"div",2)(13,"mat-form-field",3)(14,"mat-label"),r(15,"Apellido"),n(),d(16,"input",5),i(17,"mat-error"),p(18,je,1,0)(19,qe,1,0),n()()()(),i(20,"div",6)(21,"mat-form-field",7)(22,"mat-label"),r(23,"Correo electronico"),n(),d(24,"input",8),i(25,"mat-error"),p(26,ke,1,0)(27,Be,1,0),n()()(),i(28,"div",1)(29,"div",2)(30,"mat-form-field",9)(31,"mat-label"),r(32,"Contrase\xF1a"),n(),d(33,"input",10),i(34,"button",11),g("click",function(){return o.togglePasswdInpType()}),i(35,"mat-icon"),r(36," visibility "),n()(),i(37,"mat-error"),p(38,De,1,0),n()()(),i(39,"div",2)(40,"mat-form-field",7)(41,"mat-label"),r(42,"Rol"),n(),i(43,"mat-select",12)(44,"mat-option",13),r(45," Usuario "),n(),i(46,"mat-option",14),r(47," Admin "),n()(),i(48,"mat-error"),p(49,Oe,1,0),n()()()(),i(50,"div",15)(51,"button",16),r(52,"Crear cuenta"),n()()()),a&2){let m,f,_,X,Y;l(2),v("formGroup",o.registerForm),l(8),u((m=o.registerForm.get("firstName"))!=null&&m.hasError("required")?10:(m=o.registerForm.get("firstName"))!=null&&m.hasError("minlength")?11:-1),l(8),u((f=o.registerForm.get("lastName"))!=null&&f.hasError("required")?18:(f=o.registerForm.get("lastName"))!=null&&f.hasError("minlength")?19:-1),l(8),u((_=o.registerForm.get("email"))!=null&&_.hasError("required")?26:(_=o.registerForm.get("email"))!=null&&_.hasError("email")?27:-1),l(7),v("type",o.passwdInpType),l(5),u((X=o.registerForm.get("password"))!=null&&X.hasError("required")?38:-1),l(11),u((Y=o.registerForm.get("role"))!=null&&Y.hasError("required")?49:-1)}},dependencies:[L,N,T,M,j,q,U,R,A,G,B,D,O,P,ue,ie],styles:["#passwd-user[_ngcontent-%COMP%]{max-width:212px}"]})};var Ge=[{path:"login",component:V},{path:"register",component:J},{path:"**",redirectTo:"login"}],z=class e{static \u0275fac=function(a){return new(a||e)};static \u0275mod=x({type:e});static \u0275inj=E({imports:[Q.forChild(Ge),Q]})};var ve=class e{static \u0275fac=function(a){return new(a||e)};static \u0275mod=x({type:e});static \u0275inj=E({imports:[te,z,ce]})};export{de as a,Je as b,$ as c,ve as d};
